# 批量生产证书的教程

张智帅



## 1. 在excel中清洗数据

#### 1.0 序言

最好分三个工作表操作：原始数据、中间工作区、干净数据。

原始数据不要修改。拿到原始数据之后复制到一个新的表格文件，再不济也要新建一张工作表。中间工作区使用公式进行花里胡哨的操作。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583847839442.png" width="50%">

把操作所得的结果复制，粘贴为值粘贴到干净数据区。



#### 1.1 分割人名

用以下公式分割人名，使用的时候把A2换成对应的源单元格：

```vbscript
=IF(LENB(LEFT(A2,3))=2*LEN(LEFT(A2,3)),LEFT(A2,3),
    IF(LENB(LEFT(A2,2))=2*LEN(LEFT(A2,2)),LEFT(A2,2),"！需要手动处理！"))
```

其中，`LENB(LEFT(A2,3))=2*LEN(LEFT(A2,3)`是为了判断选出来的一部分是否汉字。如果前三个字都是两字符款的符号（汉字），则截取前三个字；如果前两个字是两字符宽的符号，则截取前两个字。如果出现把班号或者奇怪符号写在前面的，则标明需要手动处理。

**缺陷：无法处理使用全角符号的同学（还真有用＋号而不是+号的人！）；无法处理名字有四个字的同学。**所以需要在运行完之后人工检查一遍。

使用样例：

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583848301468.png" width="80%">



#### 1.2 分配编号

匹配靓号的公式

```vbscript
=IF(NOT(ISNA(VLOOKUP(E2,$I$4:$J$26,2,FALSE))),VLOOKUP(E2,$I$4:$J$26,2,FALSE),"")
```

在使用之前，把靓号的一小部分复制过来，先分割人名，后套用上述公式。具体配置方法和效果如下图所示。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583849081104.png" width="60%">



自动填充序列尚未完成...

```vbscript
=IF(H3="",IF(ISNA(VLOOKUP(G2+1,$J$4:$J$26,2,FALSE)),TEXT(G2+1,"000"),TEXT(G2+2,"000")),H3）（本公式未完成）
```

可能还需要手动划拉一下。通过条件格式→突出显示单元格规则→重复值，设置条件格式，把重复值标红。把**单元格格式设置为文本**，就可以从001开始填充序列了。如下图，左边是文本，右边是常规（数字）。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583593071008.png" width="15%">

#### 1.3 保存txt文件

把以上数据复制粘贴为值，贴到干净数据工作表（如果要用后文的改名程序的话，不要直接导出unicode编码的txt，linecache读取的时候会出错）。新建一个文本文件，把数据复制粘贴进去，保存。

打开这个文本文件，再次另存为txt文本文件，不过此时要把编码改成ANSI （默认是UTF-16 LE），而且要换一个名字。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583593439087.png" width="80%">





## 2. 批量替换文本

参考https://www.zhihu.com/question/36471812

#### 2.1 定义变量

把需要改的部分单独设置为图层，具体见以上链接。

**变量→定义**，把需要改变的变量设置为变量，在文本替换出打勾。

![1583850171334](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583850171334.png)

如果有三个需要改变的内容，则设置三个变量。

![1583850117448](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583850117448.png)

#### 2.2 导入数据组

**变量→数据组**，导入此前保存的ansi编码的文件，替换现有数据组。如果按照第一行是数据组名称，则不用勾选第一项。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583850273419.png" width="60%">

导入之后，一路确定。



#### 2.3 批量导出.psd文件

**文件→导出→数据组作为文件**，这里的重点是选择导出的目的文件夹，并且命名。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583850526387.png" width="60%">

如果要用上后文的批量命名文件的话，需要保证在第一个分隔符之后，要有一个编号。

点击确定，静候导出。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583594456430.png" width="60%">

自动生成大量psd文件。

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583594604147.png" width="60%">

成功！

<img src="C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583595840996.png" width="60%">



## 3. 批量转为jpg文件

#### 3.1 录制宏

录制一个宏来进行自动处理。在右侧工具栏的左上侧，点击这个叫做**动作**的按钮。

![1583594699340](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583594699340.png)

展开动作工具栏。添加一个动作，命名为”批量转换”或者任何你喜欢的名字。

![1583594833461](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583594833461.png)



#### 3.2 调用宏

**文件→自动→批处理**，打开一个选项栏。选择源文件夹和目标文件夹。

![1583850959398](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583850959398.png)

**一定要勾选“覆盖动作中的存储为命令”，否则会重新生成一遍.psd文件。**

点击确定，在目标文件夹中得到大量生成好的jpg文件。

![1583851099770](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583851099770.png)



## 4. 批量命名

代码见https://github.com/Arcadia-1/Xiaohuoban_bot/blob/master/batch_rename.ipynb

最终效果：

![1583851929713](C:\Users\hasee\AppData\Roaming\Typora\typora-user-images\1583851929713.png)